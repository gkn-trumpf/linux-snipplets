#!/bin/bash
_WORKDIR='';
_DIRUSER='';
_CMD='';

usage()
{
  echo "-- Syntax --";
  echo "Sudir is like 'sudo' by automatically using the given directory-owner, like this:"
  echo -e "$> sudir [Path] [command / arguments]\n";
  exit 1;
}

if [[ -z $@ ]];
then
  usage;
fi

if [[ ${#} == 1 ]];
then
  if [[ -d "${1}" ]];
  then
        _WORKDIR="${1}";
  else
        _WORKDIR=$(pwd);
        _CMD="${1}";
  fi
else
        _WORKDIR=$(test -z "$1" && `pwd` || echo "${1}");
        _CMD=${@: 2};
fi

if [[ ! -z "${_WORKDIR}" ]];
then
        #_DIRUSER=$(stat -c '%U' $_WORKDIR);
        _WORKDIR=$(realpath "${_WORKDIR}");
        _DIRUSER=$(stat -c '%G' "${_WORKDIR}");
else
        echo "Error: No Workdir given!"
        exit;
fi

if [[ -z $_CMD ]];
then
        _CMD=$SHELL;
fi

if [[ ! -z "${_DIRUSER}" ]] && [[ "${_DIRUSER}" != "$USER" ]];
then
        sudo su ${_DIRUSER} - -c $_CMD;
else
        $_CMD;
fi
