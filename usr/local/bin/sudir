#!/bin/bash
if [[ -z $@ ]];
then
        echo "-- Syntax --";
        echo "Sudir is like 'sudo' by automatically using the given directory-owner, like this:"
        echo -e "$> sudir [Path] [command / arguments]\n";
        exit;
fi

_WORKDIR=$(test -z "$1" && `pwd` || echo ${1});
_DIRUSER="";
_CMD=${@: 2};

if [[ ! -z "$_WORKDIR" ]];
then
        _DIRUSER=$(stat -c '%U' $_WORKDIR);
else
        echo "Error: No Workdir given!"
        exit;
fi

if [[ -z $_CMD ]];
then
        _CMD=`which bash`;
else
        _CMD="su -c ${_CMD}";
fi

if [[ ! -z $_WORKDIR ]] && [[ ! -z $_DIRUSER ]];
then
        echo "SU to '$_DIRUSER'";
        sudo -H -l -u ${_DIRUSER} $_CMD;
else
        echo "Error: Cannot determine Dir-User for '$_WORKDIR'";
        exit;
fi
